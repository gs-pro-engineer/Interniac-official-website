<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>tests.py</title>
  <link rel="stylesheet" href="../pycco.css">
</head>

<body>
  <div id='container'>
    <div id="background"></div>
    <div class='section'>
      <div class='docs'>
        <h1>tests.py</h1>
      </div>
    </div>
    <div class='clearall'>
      <div class='section' id='section-0'>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-0'>#</a>
          </div>

        </div>
        <div class='code'>
          <div class="highlight">
            <pre><span></span><span class="kn">from</span> <span class="nn">http</span> <span class="kn">import</span> <span class="n">HTTPStatus</span>
<span class="kn">from</span> <span class="nn">defender.test</span> <span class="kn">import</span> <span class="n">DefenderTestCaseMixin</span>

<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>

<span class="kn">from</span> <span class="nn">accounts.models</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">StudentProfile</span><span class="p">,</span> <span class="n">EmployerProfile</span></pre>
          </div>
        </div>
      </div>
      <div class='clearall'></div>
      <div class='section' id='section-1'>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-1'>#</a>
          </div>
        </div>
        <div class='code'>
          <div class="highlight">
            <pre><span class="k">class</span> <span class="nc">AuthenticationTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">,</span> <span class="n">DefenderTestCaseMixin</span><span class="p">):</span></pre>
          </div>
        </div>
      </div>
      <div class='clearall'></div>
      <div class='section' id='section-2'>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-2'>#</a>
          </div>

        </div>
        <div class='code'>
          <div class="highlight">
            <pre></pre>
          </div>
        </div>
      </div>
      <div class='clearall'></div>
      <div class='section' id='section-3'>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-3'>#</a>
          </div>

        </div>
        <div class='code'>
          <div class="highlight">
            <pre>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">student_registration_data</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;student@gmail.com&#39;</span><span class="p">,</span>
            <span class="s1">&#39;first_name&#39;</span><span class="p">:</span> <span class="s1">&#39;student_first&#39;</span><span class="p">,</span>
            <span class="s1">&#39;last_name&#39;</span><span class="p">:</span> <span class="s1">&#39;student_last&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password1&#39;</span><span class="p">:</span> <span class="s1">&#39;some_password&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password2&#39;</span><span class="p">:</span> <span class="s1">&#39;some_password&#39;</span><span class="p">,</span>
            <span class="s1">&#39;student_employer&#39;</span><span class="p">:</span> <span class="s1">&#39;student&#39;</span>
        <span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">employer_registration_data</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;teacher@gmail.com&#39;</span><span class="p">,</span>
            <span class="s1">&#39;first_name&#39;</span><span class="p">:</span> <span class="s1">&#39;teacher_first&#39;</span><span class="p">,</span>
            <span class="s1">&#39;last_name&#39;</span><span class="p">:</span> <span class="s1">&#39;teacher_last&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password1&#39;</span><span class="p">:</span> <span class="s1">&#39;some_password&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password2&#39;</span><span class="p">:</span> <span class="s1">&#39;some_password&#39;</span><span class="p">,</span>
            <span class="s1">&#39;student_employer&#39;</span><span class="p">:</span> <span class="s1">&#39;employer&#39;</span><span class="p">,</span>
            <span class="s1">&#39;company_name&#39;</span><span class="p">:</span> <span class="s1">&#39;some company&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">all_login_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">login_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password2&#39;</span><span class="p">]}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">login_data</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

        <span class="n">login_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;a_wrong_password&#39;</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">login_data</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">])</span>

        <span class="n">login_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;wrongemail@gmail.com&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password2&#39;</span><span class="p">]}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">login_data</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_employer_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">employer_registration_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_login_tests</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_student_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">student_registration_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_login_tests</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_register_pass_not_match</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">registration_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">student_registration_data</span><span class="p">()</span>
        <span class="n">registration_data</span><span class="p">[</span><span class="s1">&#39;password1&#39;</span><span class="p">],</span> <span class="n">registration_data</span><span class="p">[</span><span class="s1">&#39;password2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;some_rand_password&#39;</span><span class="p">,</span> <span class="s1">&#39;some_rand_password_not_same&#39;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">registration_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s1">&#39;password2&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_register_simple_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">registration_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">student_registration_data</span><span class="p">()</span>
        <span class="n">registration_data</span><span class="p">[</span><span class="s1">&#39;password1&#39;</span><span class="p">],</span> <span class="n">registration_data</span><span class="p">[</span><span class="s1">&#39;password2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;simple&#39;</span><span class="p">,</span> <span class="s1">&#39;simple&#39;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">registration_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s1">&#39;password2&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_register_existing_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">registration_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">student_registration_data</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">registration_data</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">registration_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_register_student_has_company</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">registration_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">student_registration_data</span><span class="p">()</span>
        <span class="n">registration_data</span><span class="p">[</span><span class="s1">&#39;company_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;a company&#39;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">registration_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s1">&#39;student_employer&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_register_employer_no_company</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">registration_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">employer_registration_data</span><span class="p">()</span>
        <span class="n">registration_data</span><span class="p">[</span><span class="s1">&#39;company_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">registration_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_register_not_employer_not_student</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">registration_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">student_registration_data</span><span class="p">()</span>
        <span class="n">registration_data</span><span class="p">[</span><span class="s1">&#39;student_employer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">registration_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s1">&#39;student_employer&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_register_employer_register</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">registration_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">employer_registration_data</span><span class="p">()</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">registration_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">HTTPStatus</span><span class="o">.</span><span class="n">FOUND</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">registration_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">employer_profile</span> <span class="ow">in</span> <span class="n">EmployerProfile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_register_student_register</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">registration_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">student_registration_data</span><span class="p">()</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">registration_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">HTTPStatus</span><span class="o">.</span><span class="n">FOUND</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">registration_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">profile</span> <span class="ow">in</span> <span class="n">StudentProfile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_register_invalid_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">registration_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">student_registration_data</span><span class="p">()</span>
        <span class="n">registration_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not an email&#39;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">registration_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">])</span>

</pre>
          </div>
        </div>
      </div>
      <div class='clearall'></div>
    </div>
</body>